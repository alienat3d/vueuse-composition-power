import { useFavicon, defaultDocument, useIntervalFn } from '@vueuse/core'
import { watch, ref, isRef } from 'vue'
import type { ConfigurableDocument } from '@vueuse/core'

// ? –£—Å—Ç–∞–Ω–æ–≤–∏–º –ø–∞–∫–µ—Ç "@vueuse/shared", —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø "MaybeRef".
import type { MaybeRef } from '@vueuse/shared'

// 22.4 –¢–∞–∫–∂–µ –¥–ª—è –æ–ø—Ü–∏–π composable-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω—è—Ç—å ConfigurableDocument. –ú—ã —Ö–æ—Ç–∏–º –¥–æ–±–∞–≤–∏—Ç—å –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏: 1) —Å–∫–æ—Ä–æ—Å—Ç—å –º–µ—Ä—Ü–∞–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ alert; 2) –ø—É—Ç—å –∫ —ç–º–æ–¥–∑–∏-–∫–∞—Ä—Ç–∏–Ω–∫–µ, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞–ª—ë—Ä—Ç–∞.
interface UseAlertFaviconOptions extends ConfigurableDocument {
  speed?: number
  emoji?: string
}

// 22.3 –ò—Å–ø–æ–ª—å–∑—É–µ–º TS, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø—ã –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. "src" –±—É–¥–µ—Ç —Ç–∏–ø–∞ "MaybeRef", –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ª–∏–±–æ —Å—Ç—Ä–æ–∫–æ–π, –ª–∏–±–æ null, –ª–∏–±–æ undefined, –∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é null.
// 22.5 –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–∏–ø–∞ –¥–ª—è options.
export default function useAlertFavicon(
  src: MaybeRef<string | null | undefined> = null,
  options: UseAlertFaviconOptions = {},
) {
  // 22.6 –ß—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –æ–ø—Ü–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º—ã –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ–º options –∏ —É–∫–∞–∂–µ–º –∑–Ω–∞—á–µ–Ω–∏—è. –î–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ ‚Äî 1 —Å–µ–∫. –∏ —ç—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏, –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞.
  const { speed = 500, emoji = 'üö®', document: defaultDocument } = options

  // 22.7 –î–∞–ª–µ–µ –º—ã –ø—Ä–∏–º–µ–Ω–∏–º useFavicon –∏ –ø–æ–º–µ—Å—Ç–∏–º —Ç—É–¥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ —Ñ–∞–≤–∏–∫–æ–Ω–∫–∏, —á—Ç–æ–±—ã –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –µ–π –∑–∞–¥–∞—á—É —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã —Ñ–∞–≤–∏–∫–æ–Ω–∫–∏. –ò —Ç–µ–ø–µ—Ä—å –¥–ª—è —Å–º–µ–Ω—ã —Ñ–∞–≤–∏–∫–æ–Ω–∫–∏ –Ω–∞–º –≤—Å–µ–≥–æ –ª–∏—à—å –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∏\–ø—É—Ç–∏).
  // favicon.value = "path-to-favicon"
  const favicon = useFavicon(src)

  // 22.8 –¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—â—É—é –ø—É—Ç—å –∫ —Ñ–∞–≤–∏–∫–æ–Ω–∫–µ, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –∏–∑ –ø—É—Ç–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ—Ñ, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω –æ–±—ã—á–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π.
  const theSrc = isRef(src) ? src : ref(src)

  // 22.9.0 –î–∞–ª–µ–µ –º—ã –≤—ã–∑–æ–≤–µ–º "useIntervalFn", —á—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∫–æ–Ω–∫–∏ –º–µ–∂–¥—É src –∏ alert-–∏–∫–æ–Ω–∫–æ–π.
  const { pause, resume, isActive } = useIntervalFn(() => {
    favicon.value =
      favicon.value === theSrc.value
        ? `data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${emoji}</text></svg>`
        : theSrc.value
  }, speed)
  pause() /* 22.9.1 –ò —Å—Ä–∞–∑—É –∂–µ –≤—ã–∑–æ–≤–µ–º "pause", —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –ø–æ –∫–Ω–æ–ø–∫–µ "Alert". */
  // ? –ú—ã –º–æ–≥–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π setInterval –∏–∑ JS, –Ω–æ useIntervalFn —Ç–∞–∫–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—Å—Ç–∏—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª, –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –±—É–¥–µ—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω.

  // 22.11 "cancel" –º–æ–≥ –±—ã —Å—Ç–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–µ–π "pause", –æ–¥–Ω–∞–∫–æ –Ω–∞–º –Ω—É–∂–Ω–æ —Ç–∞–∫–∂–µ –≤–µ—Ä–Ω—É—Ç—å –ø—É—Ç—å –∏–∫–æ–Ω–∫–∏ –∫ theSrc, –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–∑ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –±—ã–ª–∞ –∏–∫–æ–Ω–∫–∞ –∞–ª—ë—Ä—Ç–∞.
  const cancel = () => {
    pause()
    favicon.value = theSrc.value
  }

  // 22.13 –ê –µ—â—ë –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ theSrc –∏ –Ω–∞–∑–Ω–∞—á–∞—Ç—å –µ–≥–æ favicon.value –≤—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è. –≠—Ç–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ–∞–≤–∏–∫–æ–Ω–∫–∏ —Å–Ω–∞—Ä—É–∂–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –º—ã –æ–∂–∏–¥–∞–µ–º, –¥–∞–∂–µ –µ—Å–ª–∏ alert –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
  watch(theSrc, () => {
    favicon.value = theSrc.value
  })

  return {
    // 22.10 –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å "resume" –º—ã –º–æ–∂–µ–º –≤–µ—Ä–Ω—É—Ç—å –µ—ë –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é "alert".
    alert: resume,
    cancel,
    // 22.12 –ê —Ç–∞–∫–∂–µ –Ω–∞–¥–æ favicon –ø—Ä–∏—Å–≤–æ–∏—Ç—å theSrc, —Ç.–æ. –µ—Å–ª–∏ –æ–Ω–∞ –±—É–¥–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Å–Ω–∞—Ä—É–∂–∏ composable-—Ñ—É–Ω–∫—Ü–∏–∏, —Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∏–∫–æ–Ω–æ–∫ –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
    favicon: theSrc,
  }
}
